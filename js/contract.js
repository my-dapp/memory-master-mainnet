"use strict";var MemoryMasterContract=function(){LocalContractStorage.defineMapProperty(this,"each",{parse:function(a){return new Player(a)},stringify:function(a){return a.toString()}})};MemoryMasterContract.prototype={init:function(){},save:function(c,e){c=c.trim();e=e.trim();if(!c||!e){throw new Error("call contract exception")}var g=Blockchain.transaction.from;console.log("from : "+g);var d=this.each.get(g);console.log("player : "+d);if(d){var f=d.time;if(parseInt(f)>parseInt(e)){d.time=e;d.name=c}}else{d=new Player();d.name=c;d.address=g;d.time=e}this.each.put(g,d.toString());var b=LocalContractStorage.get("rank")||new Array();var a=new Rank(b).add(d);LocalContractStorage.set("rank",b);return a},getRank:function(){return LocalContractStorage.get("rank")}};var Player=function(a){if(a){var b=JSON.parse(a);this.name=b.name;this.address=b.address;this.time=b.time}};Player.prototype={toString:function(){return JSON.stringify(this)}};var Rank=function(a){this.MAX_NUM=10;this.rankList=a};Rank.prototype={add:function(b){var a=this._getMyHistoryDataIndexInRank(b.address);if(a!==undefined){var c=this.rankList[a].time;if(parseInt(c)>parseInt(b.time)){this.rankList[a].time=b.time;this.rankList[a].name=b.name;this._resort();return true}else{return false}}else{this.rankList.push(b);this._resort();if(this.rankList.length>this.MAX_NUM){this.rankList.length=this.MAX_NUM;return b.time>=this.rankList[this.MAX_NUM-1].time?false:true}}},_resort:function(){this.rankList.sort(function(b,a){if(parseInt(b.time)<parseInt(a.time)){return -1}else{if(parseInt(b.time)>parseInt(a.time)){return 1}else{return 0}}})},_getMyHistoryDataIndexInRank:function(b){for(var a=0;a<this.rankList.length;a++){if(this.rankList[a].address===b){return a}}return undefined}};module.exports=MemoryMasterContract;